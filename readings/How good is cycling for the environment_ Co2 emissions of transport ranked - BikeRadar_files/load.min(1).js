/*
 (C) Monetizer101. All right reserved. 
 Author: Emilio Venezia 
 Date: 2018-06-11 
*/
if(window.mtz101SearchWidgetLoaded&&"2.0.3"===window.mtz101SearchWidgetVersion)console.log('"Monetizer custom widget" already exists on the page. This is the second instance.'),console.log('Please use only 1 instance of "Monetizer custom widget" on the page');else{window.mtz101SearchWidgetLoaded=!0,window.mtz101SearchWidgetVersion="2.0.3";var MONETIZER101SEARCH=MONETIZER101SEARCH||function(){var a=!1,b={url:"https://link.monetizer101.com",map:{},currencies:["USD","CAD","GBP","EUR","CHF","DKK"]},c=function(){var a=window,b=document,c=b.documentElement,d=b.getElementsByTagName("body")[0],e=a.innerWidth||c.clientWidth||d.clientWidth;return e},d=function(a){var d=a[1],e=a[0],f=a[2],g=document.createElement("iframe");g.frameBorder=0,g.width="100%",g.setAttribute("src",b.url+"/widget/search-2.0.3/iframe.html"),g.setAttribute("id","search-widget-"+d.element),document.getElementById(d.element).appendChild(g),g.onload=function(){var a=this;a.contentWindow.postMessage([e,d,f],"*"),a.contentWindow.postMessage(["width",c()],"*"),window.addEventListener("resize",function(){a.contentWindow.postMessage(["width",c()],"*")},!0)}},e=document.querySelectorAll('[data-m101-type="search-widget"]'),f=function(c,d,f,h,i,j){if(a=!0,void 0===c&&(c=0),!(c>=d)){var k=e[c],l=JSON.parse(k.getAttribute("data-config"));if(l.element=k.id,l.limit=l.limit?parseInt(l.limit):30,l.shortenTitle=l.shortenTitle?parseInt(l.shortenTitle):"",l.excludeMerchant=l.excludeMerchant?l.excludeMerchant.split("|"):[],l.merchantFilter=!!l.merchantFilter,l.merchantNumber=l.merchantNumber?parseInt(l.merchantNumber):1,l.priceType=l.priceType?l.priceType:"SALE_PRICE",l.keywords=l.keywords?l.keywords:"",l.nameKeywords=l.nameKeywords?l.nameKeywords:"",l.nameKeywordsMatchType="EXACT",l.categoryIds=l.categoryIds?l.categoryIds:"",l.categoryFilterType=l.categoryFilterType?l.categoryFilterType:"",l.responsive=l.responsive?l.responsive:"",l.sourcePage=encodeURI(window.location.href),l.credit="","undefined"!=typeof i&&(l.price=parseFloat(i)),"undefined"!=typeof j&&(l.delta=j),"undefined"!=typeof f&&(b.url=f),l.geolocation){var m=MONETIZER101SEARCH.cookie.get("isoCurrencyCode");m?(l.isoCurrencyCode=m,l.isoLanguageCode=MONETIZER101SEARCH.cookie.get("isoLanguageCode"),g(l,c,d)):MONETIZER101SEARCH.ajax.get(b.url+"/shop-rest/api/int/shop/"+l.shopId+"/market/detect").success(function(a){var e=a.currencyCode,f=a.languageCode;-1!==MONETIZER101SEARCH.utils.inArray(e,b.currencies)&&(l.isoCurrencyCode=e,l.isoLanguageCode=f),MONETIZER101SEARCH.cookie.set("isoCurrencyCode",l.isoCurrencyCode),MONETIZER101SEARCH.cookie.set("isoLanguageCode",l.isoLanguageCode),g(l,c,d)}).error(function(){MONETIZER101SEARCH.cookie.set("isoCurrencyCode",l.isoCurrencyCode),MONETIZER101SEARCH.cookie.set("isoLanguageCode",l.isoLanguageCode),g(l,c,d)})}else g(l,c,d)}},g=function(a,c,e){var g="shop-rest/api/int/shop/"+a.shopId+"/widget/search?",h={isoCurrencyCode:a.isoCurrencyCode,isoLanguageCode:a.isoLanguageCode,categoryIds:a.categoryIds,categoryFilterType:a.categoryFilterType,merchantIds:a.merchantIds,percentOffMin:a.percentOffMin,percentOffMax:a.percentOffMax,priceType:a.priceType,resultLimit:a.limit,resultOffset:0,sortingField:a.sortingField,sortingOrder:a.sortingOrder,nameKeywords:a.keywords?a.keywords.replace(/&/g," "):a.nameKeywords.replace(/&/g," "),nameKeywordsMatchType:a.nameKeywordsMatchType,merchantFilterType:"",source:"SEARCH_WIDGET",sid:a.sid,shortenTitle:a.shortenTitle};if(a.excludeMerchant.length&&(h.merchantFilterType="EXCLUDE"),a.delta&&a.price){var i=parseInt(a.delta),j=1-i/100,k=1+i/100*3,l=parseFloat(a.price)*j,m=parseFloat(a.price)*k;h.priceMin=l.toFixed(2),h.priceMax=m.toFixed(2)}else h.priceMin=a.priceMin,h.priceMax=a.priceMax;var n=[];for(var o in h)h.hasOwnProperty(o)&&n.push(o+"="+h[o]+"&");MONETIZER101SEARCH.ajax.get(b.url+"/"+g+n.join("")).success(function(g){try{if(g.products.length){for(var h=[],i=MONETIZER101SEARCH.utils.grep(h,function(a){return a.name==g.products[j].name&&a.salePrice==g.products[j].salePrice&&a.merchantId==g.products[j].merchantId}),j=0;j<g.products.length;j++)if(a.excludeMerchant){if(-1===MONETIZER101SEARCH.utils.inArray(g.products[j].merchantId.toString(),a.excludeMerchant)&&0===i.length)if(a.merchantFilter){var k=MONETIZER101SEARCH.utils.countInArray(h,"merchantId",g.products[j].merchantId);k<a.merchantNumber&&h.push(g.products[j])}else h.push(g.products[j])}else if(0===i.length)if(a.merchantFilter){var l=MONETIZER101SEARCH.utils.countInArray(h,"merchantId",g.products[j].merchantId);l<a.merchantNumber&&h.push(g.products[j])}else h.push(g.products[j]);a.products=h,a.templateId in b.map?(d(["search",a,b.map[a.templateId]]),c++,f(c,e)):MONETIZER101SEARCH.ajax.get(b.url+"/shop-rest/api/int/shop/"+a.shopId+"/template/property/map?templateId="+a.templateId).success(function(g){b.map[a.templateId]=g,d(["search",a,g]),c++,f(c,e)})}else window.parent.postMessage(["m101HideWidget",a.element],"*"),c++,f(c,e)}catch(m){window.parent.postMessage(["m101HideWidget",a.element],"*"),c++,f(c,e)}})},h=function(){if(h.prototype._cachedResult)return h.prototype._cachedResult;var a=!!window.opr&&!!opr.addons||!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0,b="undefined"!=typeof InstallTrigger,c=/constructor/i.test(window.HTMLElement)||function(a){return"[object SafariRemoteNotification]"===a.toString()}(!window.safari||safari.pushNotification),d=!!document.documentMode,e=!d&&!!window.StyleMedia,f=!!window.chrome&&!!window.chrome.webstore;(f||a)&&!!window.CSS;return h.prototype._cachedResult=a?"Opera":b?"Firefox":c?"Safari":f?"Chrome":d?"IE":e?"Edge":"Don't know"};return window.addEventListener("message",function(a){var b=a.data[0];switch(b){case"searchSetHeight":var c=a.data[1],d=a.data[2];document.getElementById("search-widget-"+d).style.height=c+"px";break;case"m101Link":var e=a.data[1],f=h();if("Chrome"===f||"Safari"===f){var g=window.open(e,"_blank");g.location}else console.info(e),window.location.href=e}},!1),{init:function(b,c,d,g){a||f(0,e.length,b,c,d,g)}}}();!function(a){return a.utils={inArray:function(a,b){return b.indexOf(a)},grep:function(a,b,c,d){var e,f=[];c=!!c;for(var g=0,h=a.length;h>g;g++)g in a&&(e=!!b.call(d,a[g],g),c!==e&&f.push(a[g]));return f},countInArray:function(a,b,c){for(var d=0,e=0;e<a.length;e++)a[e][b]===c&&d++;return d}},a}(MONETIZER101SEARCH||{}),function(a){return a.cookie={set:function(a,b){var c=new Date,d=c.getTime();d+=36e5,c.setTime(d),document.cookie=a+"="+b+"; expires="+c.toUTCString()+"; path=/"},get:function(a){for(var b=a+"=",c=document.cookie.split(";"),d=0;d<c.length;d++){var e=c[d].trim();if(0===e.indexOf(b))return e.substring(b.length,e.length)}return""}},a}(MONETIZER101SEARCH||{}),function(a){var b={contentType:"application/x-www-form-urlencoded"},c=function(a){var b;try{b=JSON.parse(a.responseText)}catch(c){b=a.responseText}return[b,a]},d=function(a,d,e){var f={success:function(){},error:function(){},always:function(){}},g=XMLHttpRequest||ActiveXObject,h=new g("MSXML2.XMLHTTP.3.0");h.open(a,d,!0),h.setRequestHeader("Content-type",b.contentType),h.onreadystatechange=function(){var a;4===h.readyState&&(a=c(h),h.status>=200&&h.status<300?f.success.apply(f,a):f.error.apply(f,a),f.always.apply(f,a))},h.send(e);var i={success:function(a){return f.success=a,i},error:function(a){return f.error=a,i},always:function(a){return f.always=a,i}};return i};return a.ajax={},a.ajax.get=function(a){return d("GET",a)},a.ajax.put=function(a,b){return d("PUT",a,b)},a.ajax.post=function(a,b){return d("POST",a,b)},a.ajax["delete"]=function(a){return d("DELETE",a)},a.ajax.setContentType=function(a){b.contentType=a},a}(MONETIZER101SEARCH||{})}